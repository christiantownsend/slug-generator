<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <!-- <canvas id="canvas" width="2000" height="1000"></canvas> -->

    <script type="text/javascript" src="scripts/fontkit.js"></script>
    <script>
        const fontUrl = "./SLUGVariableVF.ttf";
        const slugString = "SLUG\nCLUB";

        fetch(fontUrl).then(res => res.arrayBuffer()).then(ab => {
            const font = fontkit.create(new Buffer(ab));

            let fontVariation = font.getVariation({ 'wdth': 1139 });

            // var run = fontVariation.layout('SLUGCLUB');


            wordmarkGlyphs = [];

            for (let i = 0; i < slugString.length; i++) {

                let randomWidth = Math.random() * 1139;

                let fontVariation = font.getVariation({ 'wdth': randomWidth });

                let run = fontVariation.layout(slugString[i]);

                wordmarkGlyphs.push(run);
            }

            console.log(wordmarkGlyphs);


            let wordmarkSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            wordmarkSVG.setAttribute('transform', 'scale(1 -1)');
            wordmarkSVG.setAttribute('transform-origin', 'center center');
            wordmarkSVG.setAttribute('height', 300);
            wordmarkSVG.setAttribute('width', 600);

            let x = 0;
            let y = 1520;

            for (let i = 0; i < wordmarkGlyphs.length; i++) {

                let glyph = wordmarkGlyphs[i].glyphs[0];
                if (glyph.id == 0) {
                    y -= 1450;
                    x = 0;
                    continue;
                }
                let pos = wordmarkGlyphs[i].positions[0];

                let glyphPath = document.createElementNS(
                    'http://www.w3.org/2000/svg',
                    'path'
                );

                glyphPath.setAttribute('fill', '#000000');
                glyphPath.setAttribute('transform', 'translate(' + x / 10 + ' ' + y / 10 + '), scale(.1) ');
                // glyphPath.setAttribute('x', x);
                glyphPath.setAttribute(
                    'd',
                    glyph.path.toSVG()
                );

                wordmarkSVG.appendChild(glyphPath);

                console.log(glyph.path.toSVG());

                x += pos.xAdvance;
            }

            document.body.appendChild(wordmarkSVG);

            // var canvas = document.getElementById('canvas');

            // if (canvas.getContext) {
            //     var ctx = canvas.getContext('2d');

            //     let scale = 1 / font.unitsPerEm * 300;
            //     let x = 0;
            //     let y = 1520;

            //     ctx.translate(0, 220);
            //     ctx.scale(1, -1);

            //     // run.glyphs.forEach((glyph, index) => {
            //     //     let pos = run.positions[index];
            //     //     ctx.save();
            //     //     ctx.translate((x + pos.xOffset) * scale, (y + pos.yOffset) * scale);
            //     //     ctx.beginPath();
            //     //     glyph.render(ctx, 300);

            //     //     console.log(glyph.path.toSVG());

            //     //     ctx.restore();

            //     //     x += pos.xAdvance;
            //     //     y += pos.yAdvance;
            //     // });
            // }

        });

    </script>
</body>

</html>